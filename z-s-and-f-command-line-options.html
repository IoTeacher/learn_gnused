<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>z, s and f command line options - GNU SED</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Example based guide to mastering GNU SED">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="custom.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="cover.html">Cover</a></li><li class="chapter-item expanded affix "><a href="buy.html">Buy PDF/EPUB versions</a></li><li class="chapter-item expanded "><a href="preface.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="in-place-file-editing.html"><strong aria-hidden="true">3.</strong> In-place file editing</a></li><li class="chapter-item expanded "><a href="selective-editing.html"><strong aria-hidden="true">4.</strong> Selective editing</a></li><li class="chapter-item expanded "><a href="breere-regular-expressions.html"><strong aria-hidden="true">5.</strong> BRE/ERE Regular Expressions</a></li><li class="chapter-item expanded "><a href="flags.html"><strong aria-hidden="true">6.</strong> Flags</a></li><li class="chapter-item expanded "><a href="shell-substitutions.html"><strong aria-hidden="true">7.</strong> Shell substitutions</a></li><li class="chapter-item expanded "><a href="z-s-and-f-command-line-options.html" class="active"><strong aria-hidden="true">8.</strong> z, s and f command line options</a></li><li class="chapter-item expanded "><a href="append-change-insert.html"><strong aria-hidden="true">9.</strong> append, change, insert</a></li><li class="chapter-item expanded "><a href="adding-content-from-file.html"><strong aria-hidden="true">10.</strong> Adding content from file</a></li><li class="chapter-item expanded "><a href="control-structures.html"><strong aria-hidden="true">11.</strong> Control structures</a></li><li class="chapter-item expanded "><a href="processing-lines-bounded-by-distinct-markers.html"><strong aria-hidden="true">12.</strong> Processing lines bounded by distinct markers</a></li><li class="chapter-item expanded "><a href="gotchas-and-tricks.html"><strong aria-hidden="true">13.</strong> Gotchas and Tricks</a></li><li class="chapter-item expanded "><a href="further-reading.html"><strong aria-hidden="true">14.</strong> Further Reading</a></li><li class="chapter-item expanded "><a href="Exercise_solutions.html"><strong aria-hidden="true">15.</strong> Exercise Solutions</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">GNU SED</h1>

                    <div class="right-buttons">
                        
                        <a href="https://github.com/learnbyexample/learn_gnused" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#z-s-and-f-command-line-options" id="z-s-and-f-command-line-options">z, s and f command line options</a></h1>
<p>This chapter covers the <code>-z</code>, <code>-s</code> and <code>-f</code> command line options. These come in handy for specific use cases. For example, the <code>-z</code> option helps to process input separated by ASCII NUL character and the <code>-f</code> option allows you to pass <code>sed</code> commands from a file.</p>
<h2><a class="header" href="#nul-separated-lines" id="nul-separated-lines">NUL separated lines</a></h2>
<p>The <code>-z</code> option will cause <code>sed</code> to separate lines based on the ASCII NUL character instead of the newline character. Just like normal newline based processing, the NUL character is removed (if present) from the input line and added back accordingly when the processed line is printed.</p>
<blockquote>
<p><img src="images/info.svg" alt="info" /> NUL separation is very useful to process filenames as newline is a valid character for filenames but NUL character isn't. For example, <code>grep -Z</code> and <code>find -print0</code> will print NUL separated filenames whereas <code>grep -z</code> and <code>xargs -0</code> will accept NUL separated input.</p>
</blockquote>
<pre><code class="language-bash">$ printf 'earn xerox\0at\nmare\npart\0learn eye\n' | sed -nz '/are/p'
at
mare
part

$ # \0 at end of output depends on input having \0 character
$ printf 'earn xerox\0at\nmare\npart\0learn eye\n' | sed -nz '/are/p' | od -c
0000000   a   t  \n   m   a   r   e  \n   p   a   r   t  \0
0000015
$ printf 'earn xerox\0at\nmare\npart\0learn eye\n' | sed -nz '/eye/p' | od -c
0000000   l   e   a   r   n       e   y   e  \n
0000012
</code></pre>
<p>If input doesn't have NUL characters, then <code>-z</code> option is handy to process the entire input as a single string. This is effective only for files small enough to fit your available machine memory. It would also depend on the regular expression, as some patterns have exponential relationship with respect to data size. As input doesn't have NUL character, output also wouldn't have NUL character, unlike <code>GNU grep</code> which always adds the line separator to the output.</p>
<pre><code class="language-bash">$ # adds ; to previous line if current line starts with c
$ printf 'cater\ndog\ncoat\ncutter\nmat\n' | sed -z 's/\nc/;&amp;/g'
cater
dog;
coat;
cutter
mat
</code></pre>
<h2><a class="header" href="#separate-files" id="separate-files">Separate files</a></h2>
<p>The <code>-s</code> option will cause <code>sed</code> to treat multiple input files separately instead of treating them as single concatenated input. This helps if you need line number addressing to be effective for each input file.</p>
<blockquote>
<p><img src="images/info.svg" alt="info" /> If <code>-i</code> option is being used, <code>-s</code> is also implied.</p>
</blockquote>
<pre><code class="language-bash">$ # without -s, there is only one first line for all files combined
$ # F command inserts filename of current file at the given address
$ sed '1F' cols.txt 5.txt
cols.txt
1:2:3:4
a:b:c:d
five
1five

$ # with -s, each file has its own address
$ # this is like 'cat' command but also prints filename as header
$ sed -s '1F' cols.txt 5.txt
cols.txt
1:2:3:4
a:b:c:d
5.txt
five
1five
</code></pre>
<h2><a class="header" href="#file-as-source-of-sed-commands" id="file-as-source-of-sed-commands">File as source of sed commands</a></h2>
<p>If your <code>sed</code> commands does not easily fit the command line, you have the option of putting the commands in a file and use <code>-f</code> option to specify that file as the source of commands to execute. This method also provides benefits like:</p>
<ul>
<li>literal newline can be used to separate the commands</li>
<li>single quotes can be freely used as it will no longer clash as a shell metacharacter</li>
<li>comments can be specified after the <code>#</code> character
<ul>
<li>See also <a href="https://www.gnu.org/software/sed/manual/sed.html#Common-Commands">sed manual: Often-Used Commands</a> for details about using comments</li>
</ul>
</li>
</ul>
<p>Consider the following input file and a <code>sed</code> script written into a plain text file.</p>
<pre><code class="language-bash">$ cat sample.txt
Hi there
cats and dogs running around
Have a nice day

$ cat word_mapping.sed
# word mappings
s/cat/Cat/g
s/dog/Dog/g
s/Hi/Hey/g
# appending another line
/there|running/ s/$/\n----------/
</code></pre>
<p>The two lines starting with <code>#</code> character are comment lines. Comments can also be added at end of a command line if required, just like other programming languages. Use the <code>-f</code> option to pass the contents of the file as <code>sed</code> commands. Any other command line option like <code>-n</code>, <code>-z</code>, <code>-E</code>, etc have to mentioned along with <code>sed</code> invocation, just like you've done so far.</p>
<pre><code class="language-bash">$ # the first 3 substitutions will work
$ # but not the last one, as | is not a metacharacter with BRE
$ sed -f word_mapping.sed sample.txt
Hey there
Cats and Dogs running around
Have a nice day

$ # | now works as ERE is enabled using -E option
$ sed -E -f word_mapping.sed sample.txt
Hey there
----------
Cats and Dogs running around
----------
Have a nice day
</code></pre>
<p>Similar to making an executable <code>bash</code> or <code>perl</code> or <code>python</code> script, you can add a shebang (see <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">wikipedia: shebang</a> for details) line to a <code>sed</code> script file.</p>
<pre><code class="language-bash">$ # to get full path of the command
$ type sed
sed is /usr/local/bin/sed

$ # sed script with shebang, note the use of -f after command path
$ cat executable.sed
#!/usr/local/bin/sed -f
s/cats\|dogs/'&amp;'/g

$ # add execute permission to the script
$ chmod +x executable.sed

$ # executing the script
$ ./executable.sed sample.txt
Hi there
'cats' and 'dogs' running around
Have a nice day
</code></pre>
<blockquote>
<p><img src="images/warning.svg" alt="warning" /> Adding any other command line option like <code>-n</code>, <code>-z</code>, <code>-E</code>, etc depends on a lot of factors. See <a href="https://stackoverflow.com/questions/4303128/how-to-use-multiple-arguments-with-a-shebang-i-e">stackoverflow: usage of options along with shebang</a> for details.</p>
</blockquote>
<blockquote>
<p><img src="images/info.svg" alt="info" /> See also <a href="https://www.gnu.org/software/sed/manual/sed.html#Examples">sed manual: Some Sample Scripts</a> and <a href="https://aurelio.net/projects/sedsokoban/">Sokoban game written in sed</a></p>
</blockquote>
<h2><a class="header" href="#cheatsheet-and-summary" id="cheatsheet-and-summary">Cheatsheet and summary</a></h2>
<table><thead><tr><th>Note</th><th>Description</th></tr></thead><tbody>
<tr><td><code>-z</code></td><td>change line separator from newline to ASCII NUL character</td></tr>
<tr><td></td><td><code>grep -Z</code> and <code>find -print0</code> are examples for NUL separated input</td></tr>
<tr><td></td><td><code>-z</code> also useful to process entire input as single string if it doesn't</td></tr>
<tr><td></td><td>contain NUL characters, assuming small enough input file to fit memory</td></tr>
<tr><td><code>-s</code></td><td>separate addressing for multiple file inputs</td></tr>
<tr><td></td><td><code>-s</code> is implied if <code>-i</code> is being used</td></tr>
<tr><td><code>-f</code></td><td>supply commands from a file</td></tr>
<tr><td></td><td>literal newline can be used to separate the commands</td></tr>
<tr><td></td><td>single quotes can be freely used</td></tr>
<tr><td></td><td>comments can be specified after the <code>#</code> character</td></tr>
<tr><td><code>F</code></td><td>command to insert current filename at the given address</td></tr>
</tbody></table>
<p>This chapter covered three command line options that come in handy for specific situations. You also saw a few examples of <code>sed</code> being used as part of a solution with other commands in a pipeline or a shell script. In the next chapter, you'll learn three commands that are also specialized for particular use cases.</p>
<h2><a class="header" href="#exercises" id="exercises">Exercises</a></h2>
<p><strong>a)</strong> Replace any character other than word characters and <code>.</code> character with <code>_</code> character for the sample filenames shown below.</p>
<pre><code class="language-bash">$ mkdir test_dir &amp;&amp; cd $_
$ touch 'file with spaces.txt' $'weird$ch\nars.txt' '!f@oo.txt'
$ # &gt; at start of line indicates continuation of multiline shell command
$ for file in *; do
&gt;   new_name=$(printf '%s' &quot;$file&quot; | sed ##### add your solution here)
&gt;   mv &quot;$file&quot; &quot;$new_name&quot;
&gt; done

$ ls
file_with_spaces.txt  _f_oo.txt  weird_ch_ars.txt
$ cd .. &amp;&amp; rm -r test_dir
</code></pre>
<p><strong>b)</strong> Print only the third line, if any, from these input files: <code>addr.txt</code>, <code>para.txt</code> and <code>copyright.txt</code></p>
<pre><code class="language-bash">$ sed ##### add your solution here
This game is good
project you always wanted
bla bla bla
</code></pre>
<p><strong>c)</strong> For the input file <code>hex.txt</code>, use content from <code>replace.txt</code> to perform search and replace operations. Each line in <code>replace.txt</code> starts with the search term, followed by a space and then followed by the replace term. Assume that these terms do not contain any <code>sed</code> metacharacters.</p>
<pre><code class="language-bash">$ cat hex.txt
start address: 0xA0, func1 address: 0xA0
end address: 0xFF, func2 address: 0xB0
$ cat replace.txt
0xA0 0x5000
0xB0 0x6000
0xFF 0x7000

$ sed -f &lt;(sed ##### add your solution here) hex.txt
start address: 0x5000, func1 address: 0x5000
end address: 0x7000, func2 address: 0x6000
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="shell-substitutions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="append-change-insert.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="shell-substitutions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="append-change-insert.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
